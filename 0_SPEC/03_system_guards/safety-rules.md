# 안전 규칙 (Safety Rules)
## 업무 개선 보드 시스템

---

## 1. 개요

안전 규칙은 시스템의 **보안과 데이터 무결성을 보장**하기 위한 규칙이다.

---

## 2. 데이터 안전 규칙

### 2.1 삭제 보호

| ID | 규칙 | 설명 |
|----|------|------|
| SAF-DEL-01 | 소프트 삭제 적용 | 항목 삭제 시 is_deleted=true로 설정 |
| SAF-DEL-02 | 물리적 삭제 금지 | 운영 환경에서 DELETE 쿼리 금지 |
| SAF-DEL-03 | 삭제 확인 필수 | 삭제 전 사용자 확인 다이얼로그 표시 |

### 2.2 데이터 무결성

| ID | 규칙 | 설명 |
|----|------|------|
| SAF-INT-01 | 외래키 참조 무결성 | CASCADE DELETE 금지 |
| SAF-INT-02 | 트랜잭션 적용 | 다중 테이블 수정 시 트랜잭션 필수 |
| SAF-INT-03 | 버전 관리 | 동시 수정 충돌 방지 (Optimistic Lock) |

### 2.3 이력 보존

| ID | 규칙 | 설명 |
|----|------|------|
| SAF-HIST-01 | 상태 변경 이력 필수 | 모든 상태 변경 기록 |
| SAF-HIST-02 | 이력 수정 금지 | 한번 기록된 이력은 수정 불가 |
| SAF-HIST-03 | 이력 삭제 금지 | 이력 테이블 삭제 연산 금지 |

---

## 3. 인증/인가 안전 규칙

### 3.1 인증 규칙

| ID | 규칙 | 설명 |
|----|------|------|
| SAF-AUTH-01 | HTTPS 필수 | 모든 통신 TLS 암호화 |
| SAF-AUTH-02 | 비밀번호 해싱 | bcrypt (saltRounds: 12) |
| SAF-AUTH-03 | 토큰 만료 | Access: 1시간, Refresh: 7일 |
| SAF-AUTH-04 | 세션 타임아웃 | 1시간 비활성 시 로그아웃 |

### 3.2 인가 규칙

| ID | 규칙 | 설명 |
|----|------|------|
| SAF-AUTHZ-01 | 최소 권한 원칙 | 필요한 최소 권한만 부여 |
| SAF-AUTHZ-02 | 기본 거부 | 명시적 허용 없으면 거부 |
| SAF-AUTHZ-03 | 권한 상승 금지 | 자기 권한보다 높은 권한 부여 불가 |

---

## 4. 입력 안전 규칙

### 4.1 입력 검증

| ID | 규칙 | 설명 |
|----|------|------|
| SAF-INPUT-01 | 서버 측 검증 필수 | 클라이언트 검증만으로 불충분 |
| SAF-INPUT-02 | SQL Injection 방지 | ORM 사용, Raw Query 금지 |
| SAF-INPUT-03 | XSS 방지 | 출력 이스케이프 |
| SAF-INPUT-04 | 파일 검증 | 확장자, MIME 타입, 크기 검증 |

### 4.2 파일 업로드 규칙

| ID | 규칙 | 설명 |
|----|------|------|
| SAF-FILE-01 | 허용 타입 제한 | 이미지, PDF, 문서만 허용 |
| SAF-FILE-02 | 크기 제한 | 최대 10MB |
| SAF-FILE-03 | 파일명 검증 | 경로 조작 문자 제거 |
| SAF-FILE-04 | 저장 경로 분리 | 업로드 파일 별도 디렉토리 |

---

## 5. API 안전 규칙

### 5.1 Rate Limiting

| 대상 | 제한 |
|------|------|
| 로그인 시도 | IP당 5회/분 |
| API 호출 | 사용자당 100회/분 |
| 파일 업로드 | 사용자당 10회/분 |

### 5.2 요청 검증

| ID | 규칙 | 설명 |
|----|------|------|
| SAF-API-01 | Content-Type 검증 | 예상 타입과 일치 확인 |
| SAF-API-02 | 요청 크기 제한 | Body 최대 1MB (파일 제외) |
| SAF-API-03 | CORS 적용 | 허용된 도메인만 |

---

## 6. 세션 안전 규칙

| ID | 규칙 | 설명 |
|----|------|------|
| SAF-SESS-01 | HttpOnly 쿠키 | XSS로부터 토큰 보호 |
| SAF-SESS-02 | Secure 쿠키 | HTTPS에서만 전송 |
| SAF-SESS-03 | SameSite 속성 | CSRF 방지 |
| SAF-SESS-04 | 로그아웃 시 무효화 | 서버 측 세션/토큰 폐기 |

---

## 7. 로깅 안전 규칙

| ID | 규칙 | 설명 |
|----|------|------|
| SAF-LOG-01 | 민감 정보 제외 | 비밀번호, 토큰 로깅 금지 |
| SAF-LOG-02 | 접근 로그 | 모든 인증/인가 이벤트 기록 |
| SAF-LOG-03 | 에러 로그 | 상세 정보 서버에만 저장 |
| SAF-LOG-04 | 로그 보존 | 최소 90일 보존 |

---

## 8. 배포 안전 규칙

| ID | 규칙 | 설명 |
|----|------|------|
| SAF-DEPLOY-01 | 환경 변수 관리 | 비밀키는 환경 변수로 |
| SAF-DEPLOY-02 | 소스 코드 제외 | .env 파일 커밋 금지 |
| SAF-DEPLOY-03 | 의존성 검증 | 취약점 스캔 |
| SAF-DEPLOY-04 | 컨테이너 보안 | 비루트 사용자 실행 |

---

**문서 버전**: 1.0  
**작성일**: 2026-01-19
