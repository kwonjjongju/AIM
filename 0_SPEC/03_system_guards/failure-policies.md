# 실패 정책 (Failure Policies)
## 업무 개선 보드 시스템

---

## 1. 개요

실패 정책은 시스템에서 **오류가 발생했을 때 어떻게 대응할지** 정의한다.

---

## 2. 에러 분류

### 2.1 에러 카테고리

| 카테고리 | 코드 범위 | 설명 |
|----------|-----------|------|
| Client Error | 4xx | 클라이언트 요청 오류 |
| Server Error | 5xx | 서버 내부 오류 |
| Network Error | - | 네트워크 연결 오류 |
| Database Error | - | 데이터베이스 오류 |

### 2.2 에러 코드 정의

| 코드 | 메시지 | 대응 |
|------|--------|------|
| 400 | Bad Request | 요청 수정 필요 |
| 401 | Unauthorized | 재로그인 필요 |
| 403 | Forbidden | 권한 확인 |
| 404 | Not Found | 리소스 확인 |
| 409 | Conflict | 중복 데이터 |
| 422 | Unprocessable Entity | 데이터 유효성 오류 |
| 429 | Too Many Requests | 재시도 대기 |
| 500 | Internal Server Error | 관리자 문의 |
| 503 | Service Unavailable | 잠시 후 재시도 |

---

## 3. 실패 처리 정책

### 3.1 인증 실패

| 상황 | 대응 | 사용자 안내 |
|------|------|------------|
| 잘못된 자격증명 | 401 반환 | "이메일 또는 비밀번호가 올바르지 않습니다" |
| 토큰 만료 | 자동 갱신 시도 | (조용히 갱신) |
| 갱신 토큰 만료 | 401 반환, 로그인 페이지 이동 | "세션이 만료되었습니다. 다시 로그인해주세요" |
| 토큰 위조 | 401 반환, 세션 무효화 | "인증 정보가 유효하지 않습니다" |

### 3.2 권한 오류

| 상황 | 대응 | 사용자 안내 |
|------|------|------------|
| 타인 항목 수정 시도 | 403 반환 | "본인 항목만 수정할 수 있습니다" |
| 타 부서 항목 삭제 시도 | 403 반환 | "권한이 없습니다" |
| 경영자 등록 시도 | 403 반환 | "조회만 가능합니다" |

### 3.3 데이터 유효성 오류

| 상황 | 대응 | 사용자 안내 |
|------|------|------------|
| 제목 누락 | 400 반환 | "제목을 입력해주세요" |
| 제목 100자 초과 | 400 반환 | "제목은 100자 이내로 입력해주세요" |
| 잘못된 상태 값 | 400 반환 | "유효하지 않은 상태입니다" |
| 존재하지 않는 항목 | 404 반환 | "항목을 찾을 수 없습니다" |

### 3.4 서버 오류

| 상황 | 대응 | 사용자 안내 |
|------|------|------------|
| DB 연결 실패 | 503 반환, 로그 기록 | "잠시 후 다시 시도해주세요" |
| 예외 발생 | 500 반환, 로그 기록 | "오류가 발생했습니다. 잠시 후 다시 시도해주세요" |
| 파일 업로드 실패 | 500 반환 | "파일 업로드에 실패했습니다" |

---

## 4. 재시도 정책

### 4.1 자동 재시도

| 상황 | 재시도 횟수 | 간격 |
|------|-------------|------|
| 토큰 갱신 | 1회 | 즉시 |
| API 호출 (5xx) | 3회 | 1초, 2초, 4초 (지수 백오프) |
| 네트워크 오류 | 3회 | 1초, 2초, 4초 |

### 4.2 재시도 코드

```typescript
const retryWithBackoff = async (
  fn: () => Promise<any>,
  maxRetries: number = 3,
  baseDelay: number = 1000
) => {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      const delay = baseDelay * Math.pow(2, i);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
};
```

---

## 5. 폴백 정책

### 5.1 캐시 폴백

| 상황 | 폴백 |
|------|------|
| 부서 목록 조회 실패 | Redis 캐시 사용 |
| 대시보드 통계 조회 실패 | 캐시된 데이터 표시 + "오래된 데이터" 표시 |

### 5.2 기본값 폴백

| 상황 | 기본값 |
|------|--------|
| 사용자 프로필 이미지 없음 | 기본 아바타 표시 |
| 부서 색상 없음 | 기본 색상 (#6366F1) |

---

## 6. 에러 응답 형식

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "유효하지 않은 요청입니다",
    "details": [
      {
        "field": "title",
        "message": "제목을 입력해주세요"
      }
    ]
  }
}
```

---

## 7. 로깅 정책

### 7.1 로깅 수준

| 수준 | 상황 |
|------|------|
| ERROR | 5xx 에러, 예외 발생 |
| WARN | 4xx 에러, 인증 실패 |
| INFO | 정상 요청/응답 |
| DEBUG | 상세 디버깅 정보 |

### 7.2 로깅 내용

| 항목 | 포함 여부 |
|------|-----------|
| 요청 URL | ✅ |
| HTTP Method | ✅ |
| 상태 코드 | ✅ |
| 응답 시간 | ✅ |
| 사용자 ID | ✅ |
| 에러 스택 | ✅ (ERROR 수준) |
| 비밀번호 | ❌ 절대 로깅 금지 |
| 토큰 | ❌ 마스킹 |

---

**문서 버전**: 1.0  
**작성일**: 2026-01-19
